<!--index.wxml-->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯ -->
  <view class="header">
    <button class="userinfo" hover-class="none" open-type="getUserInfo" bindgetuserinfo="onGetUserInfo">
      <image class="userinfo-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFit" wx:if="{{userInfo.avatarUrl}}"></image>
      <image class="userinfo-avatar" src="{{avatarUrl}}" mode="aspectFit" wx:else></image>
      <view class="userinfo-nickname">{{userInfo.nickName || nickName}}</view>
    </button>
  </view>

  <view class="main">
    <view class="groupName" wx:if="{{openGId}}">
      ç¾¤åï¼š
      <open-data type="groupName" open-gid="{{openGId}}"></open-data>
    </view>

    <button type="primary" hover-class="none" bindtap="showForm" style="margin: 20rpx;">ç«‹å³ä¸‹å•</button>
    <button type="primary" hover-class="none" bindtap="subscribe2" style="margin: 20rpx;">æ˜å¤©æé†’</button>
    <button type="primary" hover-class="none" bindtap="setClipboardDataAll" style="margin: 20rpx;" wx:if="{{admin && list.length}}">ä¸€é”®å¤åˆ¶</button>

    <view class="list" wx:if="{{list.length}}">
      <block wx:for="{{list}}" wx:key="index">
        <view class="list-item">
          <view class="list-item-left">
            <image class="avatar" src="{{item.userInfo.avatarUrl || avatarUrl}}" mode="aspectFit"></image>
          </view>
          <view class="list-item-right">
            <view class="nickname {{item.userInfo.gender ? 'man' : 'woman'}}">{{item.userInfo.nickName || 'åŒ¿åç”¨æˆ·'}}</view>
            <text data-data="{{item}}" bindtap="setClipboardDataOne">{{item.textarea}} {{item.goods || ''}}</text>
            <view class="address" wx:if="{{item.address.userName}}">{{item.address.userName}} {{item.address.provinceName}} {{item.address.cityName}} {{item.address.countyName}}ï¼ˆ{{item.address.detailInfo}}ï¼‰{{item.address.telNumber}}</view>
            <view class="time">{{item.time}}<text class="edit" data-data="{{item}}" bindtap="edit" wx:if="{{openid === item._openid}}">ä¿®æ”¹</text><text class="delete" data-id="{{item._id}}" bindtap="delete" wx:if="{{openid === item._openid}}">åˆ é™¤</text></view>
            <view class="action" wx:if="{{admin}}">
              <input placeholder="è¯·è¾“å…¥é‡‘é¢" data-index="{{index}}" bindinput="amountInput" />
              <text data-index="{{index}}" data-data="{{item}}" bindtap="notify">é€šçŸ¥</text>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <view class="footer">
    <image class="plus" src="{{plusUrl}}" bindtap="showForm"></image>

    <view class="form" wx:if="{{visible}}">
      <view class="btn-area">
        <button class="reset" hover-class="none" bindtap="formCancel">å–æ¶ˆ</button>
        <button class="submit" type="primary" hover-class="none" bindtap="subscribe">æŠ¥å</button>
      </view>

      <textarea class="textarea" name="textarea" maxlength="-1" value="{{textarea}}" placeholder="å…¬å¸+æ¥¼å±‚+ç‰©å“ï¼ˆæ³¨æ„ä¸è¦é‡å¤ï¼‰" bindinput="textareaInput" />

      <view class="address" bindtap="chooseAddress">
        <image class="address-image" src="{{addressUrl}}" mode="aspectFit"></image>
        <view class="address-name" wx:if="{{address.userName}}">{{address.userName}} {{address.provinceName}} {{address.cityName}} {{address.countyName}}ï¼ˆ{{address.detailInfo}}ï¼‰{{address.telNumber}}</view>
        <view wx:else>æ”¶è´§åœ°å€</view>
      </view>

      <block wx:if="{{goods.length}}">
        <view style="margin-top: 20rpx;font-size: 24rpx;text-align: center;">æ³¨æ„ä¸è¦å’ŒğŸ‘†é‡å¤</view>
        <scroll-view scroll-y="true" class="goods">
          <view class="goods-item">
            <checkbox-group bindchange="checkboxChange">
              <label class="checkbox" wx:for="{{goods}}" wx:key="index">
                <checkbox value="{{index}}" checked="{{item.checked}}"/>
                {{item.name}}ï¼ˆ{{item.price}}ï¼‰
              </label>
            </checkbox-group>
            <view>
              <view class="number" wx:for="{{goods}}" wx:key="index">
                <button data-index="{{index}}" bindtap="decrease">-</button>
                <input type="number" value="{{item.number}}" data-index="{{index}}" bindinput="numberInput" />
                <button data-index="{{index}}" bindtap="increase">+</button>
                ï¼ˆ{{item.unit}}ï¼‰
              </view>
            </view>
          </view>
        </scroll-view>
      </block>
    </view>
  </view>
</view>
